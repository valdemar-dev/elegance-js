(()=>{window.__name=e=>e;var O=e=>(a,...s)=>({tag:e,options:a||{},children:s}),M=e=>a=>({tag:e,options:a||{},children:null}),C=["area","base","br","col","embed","hr","img","input","link","meta","source","track","path","rect"],z=["a","address","article","aside","audio","blockquote","body","button","canvas","caption","colgroup","data","datalist","dd","del","details","dialog","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","html","iframe","ins","label","legend","li","main","map","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","section","select","summary","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","ul","video","span","script","abbr","b","bdi","bdo","cite","code","dfn","em","i","kbd","mark","rp","rt","ruby","s","samp","small","strong","sub","sup","u","wbr","title","svg"],w={},q={};for(const e of z)w[e]=O(e);for(const e of C)q[e]=M(e);var I={...w,...q};Object.assign(globalThis,w);Object.assign(globalThis,q);globalThis.pd||(globalThis.pd={});globalThis.ld||(globalThis.ld={});Object.assign(window,{observe:(e,a)=>({subjects:e,updateCallback:a,isAttribute:!0,type:2}),eventListener:(e,a)=>({subjects:e,eventListener:a,isAttribute:!0,type:1})});var j=new DOMParser,P=new XMLSerializer,A=new Map,L=window.location,h=document,b=[],g=e=>!e.endsWith("/")||e==="/"?e:e.slice(0,-1),y=g(L.pathname),D=(e,a)=>{const s={subjects:e.map(r=>{const t={...r,observers:new Map};return t.signal=()=>{for(const l of t.observers.values())try{l(t.value)}catch{continue}},t}),destroy:r=>{s.subjects.splice(s.subjects.indexOf(r),1)},get:r=>{const t=s.subjects.find(n=>n.id===r);if(t)return t;if(a===2)return;const l=window.location.pathname.split("/").filter(Boolean),o=[...l.map((n,i)=>"/"+l.slice(0,i+1).join("/")),"/"].reverse();for(const n of o){const i=g(n),c=ld[i];if(!c)continue;const u=c.stateManager.get(r);if(u)return u}},getAll:r=>r?.map(t=>s.get(t.id)),observe:(r,t,l)=>{r.observers.delete(l),r.observers.set(l,t)},unobserve:(r,t)=>{r.observers.delete(t)}};return s},x=(e,a,s,r)=>{if(!e)return;let t=e?.stateManager;t||(t=D(e.state||[],r),e.stateManager=t);for(const o of t.subjects)o.observers||(o.observers=new Map);for(const o of e.ooa||[]){const n=h.querySelectorAll(`[key="${o.key}"]`);let i={};for(const{id:c}of o.refs){const u=t.get(c);i[u.id]=u.value;const d=f=>{i[c]=f;try{const p=o.update(...Object.values(i));let v=o.attribute==="class"?"className":o.attribute;for(const S of Array.from(n))S[v]=p}catch{return}};d(u.value);try{t.observe(u,d,o.key)}catch{return}}}for(const o of e.soa||[]){const n=h.querySelector(`[key="${o.key}"]`);if(!n)continue;const i=t.get(o.id);if(typeof i.value=="function")try{n[o.attribute]=c=>i.value(t,c)}catch{return}else n[o.attribute]=i.value}const l=e.lh;for(const o of l||[]){if((s?s.startsWith(a):!1)&&r!==1)continue;const i=o.fn;try{let c;i.constructor.name==="AsyncFunction"?i(t).then(d=>{d&&b.push({cleanupFunction:d,page:`${a}`,loadHook:o,bindLevel:r})}):(c=i(t),c&&b.push({cleanupFunction:c,page:`${a}`,loadHook:o,bindLevel:r}))}catch{return}}},k=(e=null)=>{const a=new URL(L.href);a.pathname=g(a.pathname);const s=a.pathname;y=s,A.set(y,P.serializeToString(h)),history.replaceState(null,"",a.href);{let r=pd[s];if(!pd)return;x(r,y,e,1)}{const r=window.location.pathname.split("/").filter(Boolean),t=[...r.map((l,o)=>"/"+r.slice(0,o+1).join("/")),"/"];for(const l of t){const o=ld[l];o&&x(o,l,e,2)}}},E=async e=>{const a=g(e.pathname);if(A.has(a))return j.parseFromString(A.get(a),"text/html");const s=await fetch(e),r=j.parseFromString(await s.text(),"text/html");{const t=Array.from(r.querySelectorAll('script[data-module="true"]')),l=Array.from(document.head.querySelectorAll('script[data-module="true"]'));for(const o of t)l.find(i=>i.src===o.src)||document.head.appendChild(o)}{const t=r.querySelector('script[data-page="true"]');if(!t)return;pd[a]||await import(t.src)}{const t=Array.from(r.querySelectorAll('script[data-layout="true"]'));for(const l of t){const o=new URL(l.src,window.location.origin),n=o.pathname.substring(0,o.pathname.lastIndexOf("/"))||"/",i=g(n);ld[i]||await import(l.src)}}return A.set(a,P.serializeToString(r)),r},T=async(e,a=!0)=>{const s=new URL(e),r=g(s.pathname);let t=await E(s);if(!t||r===y)return;for(const n of[...b])if(!r.startsWith(n.page)||n.bindLevel===1){try{n.cleanupFunction()}catch{return}b.splice(b.indexOf(n),1)}let l=h.body,o=t.body;{const n=Array.from(t.querySelectorAll("template[layout-id]")),i=Array.from(h.querySelectorAll("template[layout-id]")),c=Math.min(n.length,i.length);for(let u=0;u<c;u++){const d=n[u],f=i[u],p=d.getAttribute("layout-id"),v=f.getAttribute("layout-id");if(p!==v)break;l=f.nextElementSibling,o=d.nextElementSibling}}l.replaceWith(o);{h.head.querySelector("title")?.replaceWith(t.head.querySelector("title")??"");const n=(u,d,f)=>{for(const p of u)d.find(S=>S.isEqualNode(p))||f(p)},i=Array.from([...Array.from(document.head.querySelectorAll("link")),...Array.from(document.head.querySelectorAll("meta")),...Array.from(document.head.querySelectorAll("script")),...Array.from(document.head.querySelectorAll("base")),...Array.from(document.head.querySelectorAll("style"))]),c=Array.from([...Array.from(t.head.querySelectorAll("link")),...Array.from(t.head.querySelectorAll("meta")),...Array.from(t.head.querySelectorAll("script")),...Array.from(t.head.querySelectorAll("base")),...Array.from(t.head.querySelectorAll("style"))]);n(c,i,u=>document.head.appendChild(u)),n(i,c,u=>u.remove())}a&&history.pushState(null,"",s.href),k(y),y=r,s.hash&&h.getElementById(s.hash.slice(1))?.scrollIntoView()};window.onpopstate=async e=>{e.preventDefault();const a=e.target;await T(a.location.href,!1),history.replaceState(null,"",a.location.href)};var m=(e,a)=>{if(typeof e=="boolean")return null;if(typeof e=="number"||typeof e=="string")return document.createTextNode(e.toString());if(Array.isArray(e)){const r=document.createDocumentFragment();return e.forEach(t=>{const l=m(t,a);l&&r.appendChild(l)}),r}const s=document.createElement(e.tag);if(typeof e.options!="object"&&e.options!==void 0){const r=m(e.options,a);r&&s.appendChild(r)}else if(typeof e.options=="object"){const{tag:r,options:t,children:l}=e.options;if(r!==void 0||t!==void 0||l!==void 0){const o=m(e.options,a);o&&s.appendChild(o)}else for(const[o,n]of Object.entries(e.options)){if(typeof n=="object"){const{isAttribute:i}=n;if(i===void 0||i===!1)throw"";a.push({...n,field:o,element:s});continue}s.setAttribute(o.toLowerCase(),n)}}if(e.children!==null)if(Array.isArray(e.children))e.children.forEach(r=>{const t=m(r,a);t&&s.appendChild(t)});else{const r=m(e.children,a);r&&s.appendChild(r)}return s};globalThis.client={navigateLocally:T,fetchPage:E,currentPage:y,sanitizePathname:g,getReference:e=>document.querySelector(`[ref="${e}"]`),renderRecursively:m};try{k()}catch{}})();
