<!DOCTYPE html><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta charset="UTF-8"><script data-page="true" type="module" src="/middleware/page_data.js" defer="true"></script><script type="module" src="/client.js" defer="true"></script><title>Page!</title><article><h1 class="pb-2 mt-12 text-4xl">Middleware</h1><p>Middleware refers to code that runs <em>between</em> a request being received<br/>by the server, and the server responding to that request.<br/><br/></p><p>It's useful for things like controlling who has access to what parts of your project.<br/><br/></p><p>Elegance has full support for Express-style middleware.</p><h2 class="pb-2 mt-12 text-3xl">Using Middleware</h2><p>First, create a <strong>middleware.ts</strong> file in any directory / subdirectory of <strong>pages</strong>.<br/>From that file, any export will be treated as a middleware function, like so:<div class="bg-darken dark:bg-lighten p-2 rounded-sm w-max hover:cursor-pointer hover:opacity-80 duration-100 select-none my-2" key="16"><code class="font-plex-mono">export async function Middleware(req, res, next) {}</code></div><br/></p><p>This is very similar to <em>route handlers</em> for API Routes, with two key differences.<br/><br/></p><p>1. API Routes define the <em>http method</em> they will be called for, whereas Middleware<br/>is called for <em>every</em> method in the route that it is registered to.<br/><br/></p><p>2. The middleware is exposed to the <strong>next()</strong> function, which it should call to forward<br/>the request to the next middleware.<br/><br/></p><h2 class="pb-2 mt-12 text-3xl">Useful Things</h2><p>You can register multiple middleware in a <strong>middleware.ts</strong> file,<br/>they will be called in the order that this import gives them in.<br/><div class="bg-darken dark:bg-lighten p-2 rounded-sm w-max hover:cursor-pointer hover:opacity-80 duration-100 select-none my-2" key="17"><code class="font-plex-mono">const middlewares = await import(middlewareFile);</code></div><br/></p><p>The <strong>TypeScript types</strong> of <em>req</em> and <em>res</em> are:<div class="bg-darken dark:bg-lighten p-2 rounded-sm w-max hover:cursor-pointer hover:opacity-80 duration-100 select-none my-2" key="18"><code class="font-plex-mono">req: http.IncomingMessage, res: http.ServerResponse</code></div>as declared in the <strong>node:http</strong> library.</p></article>