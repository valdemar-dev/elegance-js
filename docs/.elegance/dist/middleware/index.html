<!DOCTYPE html><html lang="en"><script data-layout="true" type="module" src="/layout_data.js" defer="true"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta charset="UTF-8"><script data-page="true" type="module" src="/middleware/page_data.js" defer="true"></script><script type="module" src="/client.js" defer="true"></script><title>Page!</title><link rel="stylesheet" href="/index.css"/></html><body class="bg-background-10 text-text-10 font-inter grid grid-cols-[20rem_auto]"><div class="fixed bottom-0 right-4 w-max h-max p-2 bg-text-00 border-[1px] border-text-05 rounded-full px-4 uppercase font-bold text-xs" hidden="false" id="toaster"></div><div class="p-8"><h5 class="text-lg font-semibold mb-2">Reference</h5><ul class="flex flex-col gap-0"><div><a class="text-xs uppercase font-bold opacity-70 hover:opacity-50" prefetch="hover" href="/" key="1">Introduction</a></div><div><a class="text-xs uppercase font-bold opacity-70 hover:opacity-50" prefetch="hover" href="/routing" key="2">Routing</a></div><div><a class="text-xs uppercase font-bold opacity-70 hover:opacity-50" prefetch="hover" href="/middleware" key="3">Middleware</a></div><div><a class="text-xs uppercase font-bold opacity-70 hover:opacity-50" prefetch="hover" href="/loadhook" key="4">Loadhook</a></div></ul></div><template layout-id="10"></template><article><h1 class="pb-2 mt-12 text-4xl">Middleware</h1><p>Middleware refers to code that runs <em>between</em> a request being received<br/>by the server, and the server responding to that request.<br/><br/></p><p>It's useful for things like controlling who has access to what parts of your project.<br/><br/></p><p>Elegance has full support for Express-style middleware.</p><h2 class="pb-2 mt-12 text-3xl">Using Middleware</h2><p>First, create a <strong>middleware.ts</strong> file in any directory / subdirectory of <strong>pages</strong>.<br/>From that file, any export will be treated as a middleware function, like so:<div class="bg-text-00 p-2 rounded-sm w-max hover:cursor-pointer hover:opacity-80 duration-100 select-none my-2" key="5"><code class="font-plex-mono">export async function Middleware(req, res, next) {}</code></div><br/></p><p>This is very similar to <em>route handlers</em> for API Routes, with two key differences.<br/><br/></p><p>1. API Routes define the <em>http method</em> they will be called for, whereas Middleware<br/>is called for <em>every</em> method in the route that it is registered to.<br/><br/></p><p>2. The middleware is exposed to the <strong>next()</strong> function, which it should call to forward<br/>the request to the next middleware.<br/><br/></p><h2 class="pb-2 mt-12 text-3xl">Useful Things</h2><p>You can register multiple middleware in a <strong>middleware.ts</strong> file,<br/>they will be called in the order that this import gives them in.<br/><div class="bg-text-00 p-2 rounded-sm w-max hover:cursor-pointer hover:opacity-80 duration-100 select-none my-2" key="6"><code class="font-plex-mono">const middlewares = await import(middlewareFile);</code></div><br/></p><p>The <strong>TypeScript types</strong> of <em>req</em> and <em>res</em> are:<div class="bg-text-00 p-2 rounded-sm w-max hover:cursor-pointer hover:opacity-80 duration-100 select-none my-2" key="7"><code class="font-plex-mono">req: http.IncomingMessage, res: http.ServerResponse</code></div>as declared in the <strong>node:http</strong> library.</p></article><footer class="h-48"></footer></body>