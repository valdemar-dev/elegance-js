(()=>{window.__name=e=>e;var q=e=>(r,...n)=>({tag:e,options:r||{},children:n}),C=e=>r=>({tag:e,options:r||{},children:null}),M=["area","base","br","col","embed","hr","img","input","link","meta","source","track","path","rect"],D=["a","address","article","aside","audio","blockquote","body","button","canvas","caption","colgroup","data","datalist","dd","del","details","dialog","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","html","iframe","ins","label","legend","li","main","map","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","section","select","summary","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","ul","video","span","script","abbr","b","bdi","bdo","cite","code","dfn","em","i","kbd","mark","rp","rt","ruby","s","samp","small","strong","sub","sup","u","wbr","title","svg"],S={},A={};for(const e of D)S[e]=q(e);for(const e of M)A[e]=C(e);var z={...S,...A};Object.assign(globalThis,S);Object.assign(globalThis,A);globalThis.pd||(globalThis.pd={});globalThis.ld||(globalThis.ld={});Object.assign(window,{observe:(e,r)=>({subjects:e,updateCallback:r,isAttribute:!0,type:2}),eventListener:(e,r)=>({subjects:e,eventListener:r,isAttribute:!0,type:1})});var j=new DOMParser,P=new XMLSerializer,v=new Map,x=window.location,p=document,m=[],g=e=>!e.endsWith("/")||e==="/"?e:e.slice(0,-1),f=g(x.pathname),I=e=>{const r={subjects:e.map(n=>{const t={...n,observers:new Map};return t.signal=()=>{for(const o of t.observers.values())try{o(t.value)}catch{continue}},t}),destroy:n=>{r.subjects.splice(r.subjects.indexOf(n),1)},get:(n,t)=>r.subjects.find(o=>o.id===n),getAll:n=>n?.map(t=>r.get(t.id)),observe:(n,t,o)=>{n.observers.delete(o),n.observers.set(o,t)},unobserve:(n,t)=>{n.observers.delete(t)}};return r},L=(e,r,n,t)=>{if(!e)return;let o=e?.stateManager;o||(o=I(e.state||[]),e.stateManager=o);for(const a of o.subjects)a.observers=new Map;for(const a of e.ooa||[]){const s=p.querySelectorAll(`[key="${a.key}"]`);let i={};for(const{id:l}of a.refs){const u=o.get(l);i[u.id]=u.value;const d=y=>{i[l]=y;try{const b=a.update(...Object.values(i));let w=a.attribute==="class"?"className":a.attribute;for(const T of Array.from(s))T[w]=b}catch{return}};d(u.value);try{o.observe(u,d,a.key)}catch{return}}}for(const a of e.soa||[]){const s=p.querySelector(`[key="${a.key}"]`);if(!s)continue;const i=o.get(a.id);if(typeof i.value=="function")try{s[a.attribute]=l=>i.value(o,l)}catch{return}else s[a.attribute]=i.value}const c=e.lh;for(const a of c||[]){if((n?n.startsWith(r):!1)&&t!==1)continue;const i=a.fn;try{let l;i.constructor.name==="AsyncFunction"?i(o).then(d=>{d&&m.push({cleanupFunction:d,page:`${r}`,loadHook:a,bindLevel:t})}):(l=i(o),l&&m.push({cleanupFunction:l,page:`${r}`,loadHook:a,bindLevel:t}))}catch{return}}},E=(e=null)=>{const r=new URL(x.href);r.pathname=g(r.pathname);const n=r.pathname;f=n,v.set(f,P.serializeToString(p)),history.replaceState(null,"",r.href);{let t=pd[n];if(!pd)return;L(t,f,e,1)}{const t=window.location.pathname.split("/").filter(Boolean),o=[...t.map((c,a)=>"/"+t.slice(0,a+1).join("/")),"/"];for(const c of o){const a=ld[c];a&&L(a,c,e,2)}}},O=async e=>{const r=g(e.pathname);if(v.has(r))return j.parseFromString(v.get(r),"text/html");const n=await fetch(e),t=j.parseFromString(await n.text(),"text/html");{const o=Array.from(t.querySelectorAll('script[data-module="true"]')),c=Array.from(document.head.querySelectorAll('script[data-module="true"]'));for(const a of o)c.find(i=>i.src===a.src)||document.head.appendChild(a)}{const o=t.querySelector('script[data-page="true"]');if(!o)return;pd[r]||await import(o.src)}{const o=Array.from(t.querySelectorAll('script[data-layout="true"]'));for(const c of o){const a=new URL(c.src,window.location.origin),s=a.pathname.substring(0,a.pathname.lastIndexOf("/"))||"/",i=g(s);ld[i]||await import(c.src)}}return v.set(r,P.serializeToString(t)),t},k=async(e,r=!0)=>{const n=new URL(e),t=g(n.pathname);let o=await O(n);if(!o||t===f)return;for(const s of[...m])if(!t.startsWith(s.page)||s.bindLevel===1){try{s.cleanupFunction()}catch{return}m.splice(m.indexOf(s),1)}let c=p.body,a=o.body;{const s=Array.from(o.querySelectorAll("template[layout-id]")),i=Array.from(p.querySelectorAll("template[layout-id]")),l=Math.min(s.length,i.length);for(let u=0;u<l;u++){const d=s[u],y=i[u],b=d.getAttribute("layout-id"),w=y.getAttribute("layout-id");if(b!==w)break;c=y.parentElement,a=d.parentElement}}c.replaceChildren(...Array.from(a.children)),p.head.replaceWith(o.head),r&&history.pushState(null,"",n.href),E(f),f=t,n.hash&&p.getElementById(n.hash.slice(1))?.scrollIntoView()};window.onpopstate=async e=>{e.preventDefault();const r=e.target;await k(r.location.href,!1),history.replaceState(null,"",r.location.href)};var h=(e,r)=>{if(typeof e=="boolean")return null;if(typeof e=="number"||typeof e=="string")return document.createTextNode(e.toString());if(Array.isArray(e)){const t=document.createDocumentFragment();return e.forEach(o=>{const c=h(o,r);c&&t.appendChild(c)}),t}const n=document.createElement(e.tag);if(typeof e.options!="object"&&e.options!==void 0){const t=h(e.options,r);t&&n.appendChild(t)}else if(typeof e.options=="object"){const{tag:t,options:o,children:c}=e.options;if(t!==void 0||o!==void 0||c!==void 0){const a=h(e.options,r);a&&n.appendChild(a)}else for(const[a,s]of Object.entries(e.options)){if(typeof s=="object"){const{isAttribute:i}=s;if(i===void 0||i===!1)throw"";r.push({...s,field:a,element:n});continue}n.setAttribute(a.toLowerCase(),s)}}if(e.children!==null)if(Array.isArray(e.children))e.children.forEach(t=>{const o=h(t,r);o&&n.appendChild(o)});else{const t=h(e.children,r);t&&n.appendChild(t)}return n};globalThis.client={navigateLocally:k,fetchPage:O,currentPage:f,sanitizePathname:g,getReference:e=>document.querySelector(`[ref="${e}"]`),renderRecursively:h};try{E()}catch{}})();
