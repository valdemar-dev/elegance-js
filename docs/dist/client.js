(()=>{window.__name=e=>e;var M=e=>(r,...a)=>({tag:e,options:r||{},children:a}),q=e=>r=>({tag:e,options:r||{},children:null}),C=["area","base","br","col","embed","hr","img","input","link","meta","source","track","path","rect"],D=["a","address","article","aside","audio","blockquote","body","button","canvas","caption","colgroup","data","datalist","dd","del","details","dialog","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","html","iframe","ins","label","legend","li","main","map","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","section","select","summary","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","ul","video","span","script","abbr","b","bdi","bdo","cite","code","dfn","em","i","kbd","mark","rp","rt","ruby","s","samp","small","strong","sub","sup","u","wbr","title","svg"],y={},v={};for(const e of D)y[e]=M(e);for(const e of C)v[e]=q(e);var N={...y,...v};Object.assign(globalThis,y);Object.assign(globalThis,v);globalThis.pd||(globalThis.pd={});globalThis.ld||(globalThis.ld={});Object.assign(window,{observe:(e,r)=>({subjects:e,updateCallback:r,isAttribute:!0,type:2}),eventListener:(e,r)=>({subjects:e,eventListener:r,isAttribute:!0,type:1})});var j=new DOMParser,x=new XMLSerializer,m=new Map,P=window.location,p=document,b=[],f=e=>!e.endsWith("/")||e==="/"?e:e.slice(0,-1),d=f(P.pathname),F=e=>{const r={subjects:e.map(a=>{const t={...a,observers:new Map};return t.signal=()=>{for(const o of t.observers.values())try{o(t.value)}catch{continue}},t}),destroy:a=>{r.subjects.splice(r.subjects.indexOf(a),1)},get:(a,t)=>r.subjects.find(o=>o.id===a),getAll:a=>a?.map(t=>r.get(t.id)),observe:(a,t,o)=>{a.observers.delete(o),a.observers.set(o,t)},unobserve:(a,t)=>{a.observers.delete(t)}};return r},A=(e,r,a,t)=>{if(!e)return;let o=e?.stateManager;o||(o=F(e.state||[]),e.stateManager=o);for(const n of o.subjects)n.observers=new Map;for(const n of e.ooa||[]){const c=p.querySelectorAll(`[key="${n.key}"]`);let s={};for(const{id:l}of n.refs){const h=o.get(l);s[h.id]=h.value;const g=w=>{s[l]=w;try{const S=n.update(...Object.values(s));let O=n.attribute==="class"?"className":n.attribute;for(const L of Array.from(c))L[O]=S}catch{return}};g(h.value);try{o.observe(h,g,n.key)}catch{return}}}for(const n of e.soa||[]){const c=p.querySelector(`[key="${n.key}"]`),s=o.get(n.id);if(typeof s.value=="function")try{c[n.attribute]=l=>s.value(o,l)}catch{return}else c[n.attribute]=s.value}const i=e.lh;for(const n of i||[]){if((a?a.startsWith(r):!1)&&t!==1)continue;const s=n.fn;try{let l;s.constructor.name==="AsyncFunction"?s(o).then(g=>{g&&b.push({cleanupFunction:g,page:`${r}`,loadHook:n,bindLevel:t})}):(l=s(o),l&&b.push({cleanupFunction:l,page:`${r}`,loadHook:n,bindLevel:t}))}catch{return}}},T=(e=null)=>{const r=new URL(P.href);r.pathname=f(r.pathname);const a=r.pathname;d=a,m.set(d,x.serializeToString(p)),history.replaceState(null,"",r.href);{let t=pd[a];if(!pd)return;A(t,d,e,1)}{const t=window.location.pathname.split("/").filter(Boolean),o=[...t.map((i,n)=>"/"+t.slice(0,n+1).join("/")),"/"];for(const i of o){const n=ld[i];n&&A(n,i,e,2)}}},k=async e=>{const r=f(e.pathname);if(m.has(r))return j.parseFromString(m.get(r),"text/html");const a=await fetch(e),t=j.parseFromString(await a.text(),"text/html");{const o=Array.from(t.querySelectorAll('script[data-module="true"]')),i=Array.from(document.head.querySelectorAll('script[data-module="true"]'));for(const n of o)i.find(s=>s.src===n.src)||document.head.appendChild(n)}{const o=t.querySelector('script[data-page="true"]');if(!o)return;pd[r]||await import(o.src)}{const o=Array.from(t.querySelectorAll('script[data-layout="true"]'));for(const i of o){const n=new URL(i.src,window.location.origin),c=n.pathname.substring(0,n.pathname.lastIndexOf("/"))||"/",s=f(c);ld[s]||await import(i.src)}}return m.set(r,x.serializeToString(t)),t},E=async(e,r=!0)=>{const a=new URL(e),t=f(a.pathname);let o=await k(a);if(!o||t===d)return;for(const c of[...b])if(!t.startsWith(c.page)||c.bindLevel===1){try{c.cleanupFunction()}catch{return}b.splice(b.indexOf(c),1)}const i=p.body,n=o.body;i.replaceWith(n),p.head.replaceWith(o.head),r&&history.pushState(null,"",a.href),T(d),d=t,a.hash&&p.getElementById(a.hash.slice(1))?.scrollIntoView()};window.onpopstate=async e=>{e.preventDefault();const r=e.target;await E(r.location.href,!1),history.replaceState(null,"",r.location.href)};var u=(e,r)=>{if(typeof e=="boolean")return null;if(typeof e=="number"||typeof e=="string")return document.createTextNode(e.toString());if(Array.isArray(e)){const t=document.createDocumentFragment();return e.forEach(o=>{const i=u(o,r);i&&t.appendChild(i)}),t}const a=document.createElement(e.tag);if(typeof e.options!="object"&&e.options!==void 0){const t=u(e.options,r);t&&a.appendChild(t)}else if(typeof e.options=="object"){const{tag:t,options:o,children:i}=e.options;if(t!==void 0||o!==void 0||i!==void 0){const n=u(e.options,r);n&&a.appendChild(n)}else for(const[n,c]of Object.entries(e.options)){if(typeof c=="object"){const{isAttribute:s}=c;if(s===void 0||s===!1)throw"";r.push({...c,field:n,element:a});continue}a.setAttribute(n.toLowerCase(),c)}}if(e.children!==null)if(Array.isArray(e.children))e.children.forEach(t=>{const o=u(t,r);o&&a.appendChild(o)});else{const t=u(e.children,r);t&&a.appendChild(t)}return a};globalThis.client={navigateLocally:E,fetchPage:k,currentPage:d,sanitizePathname:f,getReference:e=>document.querySelector(`[ref="${e}"]`),renderRecursively:u};try{T()}catch{}})();
