(()=>{window.__name=e=>e;var F=e=>(o,...a)=>({tag:e,options:o||{},children:a}),$=e=>o=>({tag:e,options:o||{},children:null}),N=["area","base","br","col","embed","hr","img","input","link","meta","source","track","path","rect"],R=["a","address","article","aside","audio","blockquote","body","button","canvas","caption","colgroup","data","datalist","dd","del","details","dialog","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","html","iframe","ins","label","legend","li","main","map","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","section","select","summary","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","ul","video","span","script","abbr","b","bdi","bdo","cite","code","dfn","em","i","kbd","mark","rp","rt","ruby","s","samp","small","strong","sub","sup","u","wbr","title","svg"],j={},P={};for(const e of R)j[e]=F(e);for(const e of N)P[e]=$(e);var I={...j,...P};Object.assign(globalThis,j);Object.assign(globalThis,P);globalThis.pd||(globalThis.pd={});Object.assign(window,{observe:(e,o)=>({subjects:e,updateCallback:o,isAttribute:!0,type:2}),eventListener:(e,o)=>({subjects:e,eventListener:o,isAttribute:!0,type:1})});var x=new DOMParser,O=new XMLSerializer,A=new Map,M=window.location,p=document,b=[],k=Array.from,m=e=>!e.endsWith("/")||e==="/"?e:e.slice(0,-1),h=m(M.pathname),z=e=>{const o={subjects:e.map(a=>{const t={...a,observers:new Map};return t.signal=()=>{for(const r of t.observers.values())try{r(t.value)}catch{continue}},t}),destroy:a=>{o.subjects.splice(o.subjects.indexOf(a),1)},get:(a,t)=>o.subjects.find(r=>r.id===a),getAll:a=>a?.map(t=>t.bind?pd[t.bind].get(t.id):o.get(t.id)),observe:(a,t,r)=>{a.observers.delete(r),a.observers.set(r,t)},unobserve:(a,t)=>{a.observers.delete(t)}};return o},D=e=>{let o=e.stateManager;o||(o=z(e.state||[]),e.stateManager=o);for(const t of o.subjects)t.observers=new Map;for(const t of e.ooa||[]){const r=p.querySelectorAll(`[key="${t.key}"]`);let s={};for(const{id:n,bind:l}of t.refs){const c=o.get(n,l);s[c.id]=c.value;const y=g=>{s[n]=g;try{const v=t.update(...Object.values(s));let S=t.attribute==="class"?"className":t.attribute;for(const w of Array.from(r))w[S]=v}catch{return}};y(c.value);try{o.observe(c,y,t.key)}catch{return}}}for(const t of e.soa||[]){const r=p.querySelector(`[key="${t.key}"]`),s=o.get(t.id,t.bind);if(typeof s.value=="function")try{r[t.attribute]=n=>s.value(o,n)}catch{return}else r[t.attribute]=s.value}const a=e.lh;for(const t of a||[]){const r=t.bind??"";if(r!=="")continue;const s=t.fn;try{let n;s.constructor.name==="AsyncFunction"?s(o).then(c=>{c&&b.push({cleanupFunction:c,bind:`${r}`})}):(n=s(o),n&&b.push({cleanupFunction:n,bind:`${r}`}))}catch{return}}},T=(e=null)=>{const o=new URL(M.href);o.pathname=m(o.pathname);const a=o.pathname;h=a,history.replaceState(null,"",o.href);{let t=pd[a];if(pd===void 0)return;D(t)}{const t=window.location.pathname.split("/").filter(Boolean),r=[...t.map((s,n)=>"/"+t.slice(0,n+1).join("/")),"/"];for(const s of r){const n=ld[s];n&&D(n)}}A.set(h,O.serializeToString(p))},q=async e=>{const o=m(e.pathname);if(A.has(o))return x.parseFromString(A.get(o),"text/html");const a=await fetch(e),t=x.parseFromString(await a.text(),"text/html");{const r=Array.from(t.querySelectorAll('script[data-module="true"]')),s=Array.from(document.head.querySelectorAll('script[data-module="true"]'));for(const n of r)s.find(c=>c.src===n.src)||document.head.appendChild(n)}{const r=t.querySelector('script[data-page="true"]');if(!r)return;pd[o]||await import(r.src)}{const r=Array.from(t.querySelectorAll('script[data-layout="true"]'));for(const s of r){const n=new URL(s.src,location.origin),l=n.pathname.substring(0,n.pathname.lastIndexOf("/"));ld[l]||await import(s.src)}}return A.set(o,O.serializeToString(t)),t},B=async(e,o=!0)=>{const a=new URL(e),t=m(a.pathname);let r=await q(a);if(!r||t===h)return;const s=k(p.querySelectorAll("div[bp]")),n=s.map(i=>i.getAttribute("bp")),l=k(r.querySelectorAll("div[bp]")),c=l.map(i=>i.getAttribute("bp")),y=(i,d)=>{let u=0;const C=Math.min(i.length,d.length);for(;u<C&&i[u].getAttribute("bp")===d[u].getAttribute("bp");)u++;return u>0?[i[u-1],d[u-1]]:[document.body,r.body]},[g,v]=y(s,l),S=[],w=g.getAttribute("key"),L=i=>{const d=i.getAttribute("key");if(d&&S.push(d),!(d===w||!w))for(const u of k(i.children))L(u)};L(p.body);const E=n.filter(i=>!c.includes(i)),U=c.filter(i=>!n.includes(i));for(const i of[...b]){const d=i.bind;if(d.length<1||E.includes(d)){try{i.cleanupFunction()}catch{return}b.splice(b.indexOf(i),1)}}g.replaceWith(v),p.head.replaceWith(r.head),o&&history.pushState(null,"",a.href),T(h),h=t,a.hash&&p.getElementById(a.hash.slice(1))?.scrollIntoView()};window.onpopstate=async e=>{e.preventDefault();const o=e.target;await B(o.location.href,!1),history.replaceState(null,"",o.location.href)};var f=(e,o)=>{if(typeof e=="boolean")return null;if(typeof e=="number"||typeof e=="string")return document.createTextNode(e.toString());if(Array.isArray(e)){const t=document.createDocumentFragment();return e.forEach(r=>{const s=f(r,o);s&&t.appendChild(s)}),t}const a=document.createElement(e.tag);if(typeof e.options!="object"&&e.options!==void 0){const t=f(e.options,o);t&&a.appendChild(t)}else if(typeof e.options=="object"){const{tag:t,options:r,children:s}=e.options;if(t!==void 0||r!==void 0||s!==void 0){const n=f(e.options,o);n&&a.appendChild(n)}else for(const[n,l]of Object.entries(e.options)){if(typeof l=="object"){const{isAttribute:c}=l;if(c===void 0||c===!1)throw"";o.push({...l,field:n,element:a});continue}a.setAttribute(n.toLowerCase(),l)}}if(e.children!==null)if(Array.isArray(e.children))e.children.forEach(t=>{const r=f(t,o);r&&a.appendChild(r)});else{const t=f(e.children,o);t&&a.appendChild(t)}return a};globalThis.client={navigateLocally:B,fetchPage:q,currentPage:h,sanitizePathname:m,getReference:e=>document.querySelector(`[ref="${e}"]`),renderRecursively:f};try{T()}catch{}})();
