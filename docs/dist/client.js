(()=>{window.__name=e=>e;var z=e=>(a,...t)=>({tag:e,options:a||{},children:t}),E=e=>a=>({tag:e,options:a||{},children:null}),K=["area","base","br","col","embed","hr","img","input","link","meta","source","track","path","rect"],R=["a","address","article","aside","audio","blockquote","body","button","canvas","caption","colgroup","data","datalist","dd","del","details","dialog","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","html","iframe","ins","label","legend","li","main","map","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","section","select","summary","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","ul","video","span","script","abbr","b","bdi","bdo","cite","code","dfn","em","i","kbd","mark","rp","rt","ruby","s","samp","small","strong","sub","sup","u","wbr","title","svg"],M={},O={};for(const e of R)M[e]=z(e);for(const e of K)O[e]=E(e);var U={...M,...O};Object.assign(globalThis,M);Object.assign(globalThis,O);globalThis.pd||(globalThis.pd={});Object.assign(window,{observe:(e,a)=>({subjects:e,updateCallback:a,isAttribute:!0}),eventListener:()=>{}});var B=new DOMParser,L=new XMLSerializer,j=new Map,T=window.location,h=document,v=[],P=Array.from,w=e=>!e.endsWith("/")||e==="/"?e:e.slice(0,-1),y=w(T.pathname),D=e=>{const a={subjects:e.map(t=>{const r={...t,observers:new Map};return r.signal=()=>{for(const n of r.observers.values())try{n(r.value)}catch{continue}},r}),destroy:t=>{a.subjects.splice(a.subjects.indexOf(t),1)},get:(t,r)=>r?pd[r].get(t):a.subjects.find(n=>n.id===t),getAll:t=>t?.map(r=>r.bind?pd[r.bind].get(r.id):a.get(r.id)),observe:(t,r,n)=>{t.observers.delete(n),t.observers.set(n,r)},unobserve:(t,r)=>{t.observers.delete(r)}};return a},x=(e=[],a)=>{const t=new URL(T.href);t.pathname=w(t.pathname);const r=t.pathname;y=r,history.replaceState(null,"",t.href);let n=pd[r];if(pd===void 0)return;for(const[o,c]of Object.entries(n.binds||{})){if(!pd[o]){pd[o]=D(c);continue}const l=pd[o],u=c;for(const f of u)l.get(f.id)||pd[o].subjects.push(f)}let i=n.stateManager;i||(i=D(n.state||[]),n.stateManager=i);for(const o of i.subjects)o.observers=new Map;for(const o of n.ooa||[]){const c=h.querySelectorAll(`[key="${o.key}"]`);let l={};for(const{id:u,bind:f}of o.refs){const d=i.get(u,f);l[d.id]=d.value;const b=m=>{l[u]=m;try{const S=o.update(...Object.values(l));let A=o.attribute==="class"?"className":o.attribute;for(const s of Array.from(c))s[A]=S}catch{return}};b(d.value);try{i.observe(d,b,o.key)}catch{return}}}for(const o of n.soa||[]){const c=h.querySelector(`[key="${o.key}"]`),l=i.get(o.id,o.bind);if(typeof l.value=="function")try{c[o.attribute]=u=>l.value(i,u)}catch{return}else c[o.attribute]=l.value}const k=n.lh;for(const o of k||[]){const c=o.bind;if(c!==void 0&&a&&!a.includes(`${c}`))continue;const l=o.fn;try{let u;l.constructor.name==="AsyncFunction"?l(i).then(d=>{d&&v.push({cleanupFunction:d,bind:`${c}`})}):(u=l(i),u&&v.push({cleanupFunction:u,bind:`${c}`}))}catch{return}}j.set(y,L.serializeToString(h))},$=async e=>{const a=w(e.pathname);if(j.has(a))return B.parseFromString(j.get(a),"text/html");const t=await fetch(e),r=B.parseFromString(await t.text(),"text/html"),n=r.querySelector('script[data-tag="true"]');if(n){if(!pd[a]){const{data:i}=await import(n.src);pd[a]=i}return j.set(a,L.serializeToString(r)),r}},q=async(e,a=!0)=>{const t=new URL(e),r=w(t.pathname);let n=await $(t);if(!n||r===y)return;const i=P(h.querySelectorAll("div[bp]")),k=i.map(s=>s.getAttribute("bp")),o=P(n.querySelectorAll("div[bp]")),c=o.map(s=>s.getAttribute("bp")),l=(s,p)=>{let g=0;const F=Math.min(s.length,p.length);for(;g<F&&s[g].getAttribute("bp")===p[g].getAttribute("bp");)g++;return g>0?[s[g-1],p[g-1]]:[document.body,n.body]},[u,f]=l(i,o),d=[],b=u.getAttribute("key"),m=s=>{const p=s.getAttribute("key");if(p&&d.push(p),!(p===b||!b))for(const g of P(s.children))m(g)};m(h.body);const S=k.filter(s=>!c.includes(s)),A=c.filter(s=>!k.includes(s));for(const s of[...v]){const p=s.bind;if(p.length<1||S.includes(p)){try{s.cleanupFunction()}catch{return}v.splice(v.indexOf(s),1)}}u.replaceWith(f),h.head.replaceWith(n.head),a&&history.pushState(null,"",t.href),y=r,t.hash&&h.getElementById(t.hash.slice(1))?.scrollIntoView(),x(d,A)};window.onpopstate=async e=>{e.preventDefault();const a=e.target;await q(a.location.href,!1),history.replaceState(null,"",a.location.href)};globalThis.client={navigateLocally:q,fetchPage:$,currentPage:y,sanitizePathname:w,getReference:e=>document.querySelector(`[ref="${e}"]`)};try{x()}catch{}})();
