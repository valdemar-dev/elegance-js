(()=>{window.__name=e=>e;var C=e=>(o,...r)=>({tag:e,options:o||{},children:r}),N=e=>o=>({tag:e,options:o||{},children:null}),z=["area","base","br","col","embed","hr","img","input","link","meta","source","track","path","rect"],K=["a","address","article","aside","audio","blockquote","body","button","canvas","caption","colgroup","data","datalist","dd","del","details","dialog","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","html","iframe","ins","label","legend","li","main","map","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","section","select","summary","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","ul","video","span","script","abbr","b","bdi","bdo","cite","code","dfn","em","i","kbd","mark","rp","rt","ruby","s","samp","small","strong","sub","sup","u","wbr","title","svg"],x={},M={};for(const e of K)x[e]=C(e);for(const e of z)M[e]=N(e);var R={...x,...M};Object.assign(globalThis,x);Object.assign(globalThis,M);globalThis.pd||(globalThis.pd={});Object.assign(window,{observe:(e,o)=>({subjects:e,updateCallback:o,isAttribute:!0,type:2}),eventListener:(e,o)=>({subjects:e,eventListener:o,isAttribute:!0,type:1})});var D=new DOMParser,T=new XMLSerializer,j=new Map,B=window.location,b=document,w=[],O=Array.from,S=e=>!e.endsWith("/")||e==="/"?e:e.slice(0,-1),A=S(B.pathname),L=e=>{const o={subjects:e.map(r=>{const t={...r,observers:new Map};return t.signal=()=>{for(const a of t.observers.values())try{a(t.value)}catch{continue}},t}),destroy:r=>{o.subjects.splice(o.subjects.indexOf(r),1)},get:(r,t)=>t?pd[t].get(r):o.subjects.find(a=>a.id===r),getAll:r=>r?.map(t=>t.bind?pd[t.bind].get(t.id):o.get(t.id)),observe:(r,t,a)=>{r.observers.delete(a),r.observers.set(a,t)},unobserve:(r,t)=>{r.observers.delete(t)}};return o},E=(e=[],o)=>{const r=new URL(B.href);r.pathname=S(r.pathname);const t=r.pathname;A=t,history.replaceState(null,"",r.href);let a=pd[t];if(pd===void 0)return;for(const[n,i]of Object.entries(a.binds||{})){if(!pd[n]){pd[n]=L(i);continue}const l=pd[n],d=i;for(const g of d)l.get(g.id)||pd[n].subjects.push(g)}let s=a.stateManager;s||(s=L(a.state||[]),a.stateManager=s);for(const n of s.subjects)n.observers=new Map;for(const n of a.ooa||[]){const i=b.querySelectorAll(`[key="${n.key}"]`);let l={};for(const{id:d,bind:g}of n.refs){const p=s.get(d,g);l[p.id]=p.value;const y=m=>{l[d]=m;try{const k=n.update(...Object.values(l));let P=n.attribute==="class"?"className":n.attribute;for(const c of Array.from(i))c[P]=k}catch{return}};y(p.value);try{s.observe(p,y,n.key)}catch{return}}}for(const n of a.soa||[]){const i=b.querySelector(`[key="${n.key}"]`),l=s.get(n.id,n.bind);if(typeof l.value=="function")try{i[n.attribute]=d=>l.value(s,d)}catch{return}else i[n.attribute]=l.value}const u=a.lh;for(const n of u||[]){const i=n.bind??"";if(i!==""&&o&&!o.includes(`${i}`))continue;const l=n.fn;try{let d;l.constructor.name==="AsyncFunction"?l(s).then(p=>{p&&w.push({cleanupFunction:p,bind:`${i}`})}):(d=l(s),d&&w.push({cleanupFunction:d,bind:`${i}`}))}catch{return}}j.set(A,T.serializeToString(b))},q=async e=>{const o=S(e.pathname);if(j.has(o))return D.parseFromString(j.get(o),"text/html");const r=await fetch(e),t=D.parseFromString(await r.text(),"text/html");{const a=Array.from(t.querySelectorAll('script[data-module="true"]')),s=Array.from(document.head.querySelectorAll('script[data-module="true"]'));for(const u of a)s.find(i=>i.src===u.src)||document.head.appendChild(u)}{const a=t.querySelector('script[data-tag="true"]');if(!a)return;if(!pd[o]){const{data:s}=await import(a.src);pd[o]=s}}return j.set(o,T.serializeToString(t)),t},$=async(e,o=!0)=>{const r=new URL(e),t=S(r.pathname);let a=await q(r);if(!a||t===A)return;const s=O(b.querySelectorAll("div[bp]")),u=s.map(c=>c.getAttribute("bp")),n=O(a.querySelectorAll("div[bp]")),i=n.map(c=>c.getAttribute("bp")),l=(c,f)=>{let h=0;const F=Math.min(c.length,f.length);for(;h<F&&c[h].getAttribute("bp")===f[h].getAttribute("bp");)h++;return h>0?[c[h-1],f[h-1]]:[document.body,a.body]},[d,g]=l(s,n),p=[],y=d.getAttribute("key"),m=c=>{const f=c.getAttribute("key");if(f&&p.push(f),!(f===y||!y))for(const h of O(c.children))m(h)};m(b.body);const k=u.filter(c=>!i.includes(c)),P=i.filter(c=>!u.includes(c));for(const c of[...w]){const f=c.bind;if(f.length<1||k.includes(f)){try{c.cleanupFunction()}catch{return}w.splice(w.indexOf(c),1)}}d.replaceWith(g),b.head.replaceWith(a.head),o&&history.pushState(null,"",r.href),A=t,r.hash&&b.getElementById(r.hash.slice(1))?.scrollIntoView(),E(p,P)};window.onpopstate=async e=>{e.preventDefault();const o=e.target;await $(o.location.href,!1),history.replaceState(null,"",o.location.href)};var v=(e,o)=>{if(typeof e=="boolean")return null;if(typeof e=="number"||typeof e=="string")return document.createTextNode(e.toString());if(Array.isArray(e)){const t=document.createDocumentFragment();return e.forEach(a=>{const s=v(a,o);s&&t.appendChild(s)}),t}const r=document.createElement(e.tag);if(typeof e.options=="object"&&e.options!==null){const{tag:t,options:a,children:s}=e.options;if(t!==void 0&&a!==void 0&&s!==void 0){const u=v(e.options,o);u&&r.appendChild(u)}else for(const[u,n]of Object.entries(e.options)){if(typeof n=="object"){const{isAttribute:i}=n;if(i===void 0||i===!1)throw"Objects are not valid option property values.";o.push({...n,field:u,element:r});continue}r.setAttribute(u.toLowerCase(),n)}}if(e.children!==null)if(Array.isArray(e.children))e.children.forEach(t=>{const a=v(t,o);a&&r.appendChild(a)});else{const t=v(e.children,o);t&&r.appendChild(t)}return r};globalThis.client={navigateLocally:$,fetchPage:q,currentPage:A,sanitizePathname:S,getReference:e=>document.querySelector(`[ref="${e}"]`),renderRecursively:v};try{E()}catch{}})();
