"use strict";(()=>{var j=Object.defineProperty;var i=(t,o)=>j(t,"name",{value:o,configurable:!0});var b=new DOMParser,A=new XMLSerializer,f=new Map,m=[],S=null,$=window.location.pathname,w=i(t=>!t.endsWith("/")||t==="/"?t:t.slice(0,-1),"sanitizePathname"),E=i(async t=>{let o=w(t.pathname);if(f.has(o))return b.parseFromString(f.get(o),"text/html");if(t.hostname!==window.location.hostname)return;let r=await fetch(t),u=await r.text();if(!r.ok&&r.status>=500)return;let s=b.parseFromString(u,"text/html"),d=o==="/"?o+"page_data.js":o+"/page_data.js";return pd[o]||await import(d),f.set(o,A.serializeToString(s)),s},"fetchPage"),T=i(({breakpointKey:t})=>{let o=[],r=i(u=>{let s=u.getAttribute("key");if(s&&o.push(s),u.children){if(s===t)return;for(let d of Array.from(u.children))r(d)}},"getRecursively");return r(document.body),o},"getDeprecatedKeys"),P=i(async(t,o=!0)=>{for(let n of m)n();m=[],f.set($,A.serializeToString(document));let r=new URL(t),u=w(r.pathname),s=f.get(u)??await E(r);if(!s)return;typeof s=="string"&&(s=b.parseFromString(s,"text/html"));let d=Array.from(document.querySelectorAll("div[bp]")),y=Array.from(s.querySelectorAll("div[bp]")),p=document.body,c=s.body;for(let n=0;n<d.length&&!(n>y.length-1);n++){let l=d[n],g=y[n],h=l.getAttribute("bp"),v=g.getAttribute("bp");if(h!==v)break;p=l,c=g}let e=T({breakpointKey:p.getAttribute("key")});p.parentElement?.replaceChild(c,p),document.head.replaceChildren(...Array.from(s.head.children)),o&&history.pushState(null,"",t),M(e),$=u},"navigateLocally");window.onpopstate=async t=>{t.preventDefault();let o=t.target;await P(o.location.href,!1),history.replaceState(null,"",w(o.location.pathname))};var M=i((t=[])=>{let o=w(window.location.pathname),r=pd[o];if(!r)return;let u=r.state,s=r.ooa,d=r.soa,y=r.w,p=r.plh,c={subjects:{},get:i(e=>Object.values(c.subjects).find(a=>a.id===e),"get"),set:i((e,a)=>{e.value=a,pd[e.pathname].sm.subjects[Object.keys(e)[0]]=e},"set"),signal:i(e=>{let a=e.observers;for(let n of a)n(e.value)},"signal"),observe:i((e,a)=>{e.observers.push(a)},"observe")};for(let[e,a]of Object.entries(u)){let n=a;c.subjects[e]={id:n.id,value:n.value,observers:[],pathname:o}}r.sm=c;for(let e of s||[]){if(e.key in t)continue;let a=document.querySelector(`[key="${e.key}"]`),n={};for(let l of e.ids){let g=c.get(l);if(!g)return;n[g.id]=g.value;let h=i(v=>{n[l]=v;let L=e.update(...Object.values(n)),k=e.attribute;switch(k){case"class":k="className";break}a[k]=L},"updateFunction");c.observe(g,h)}}for(let e of d||[]){if(e.key in t)continue;let a=document.querySelector(`[key="${e.key}"]`);if(!a)return;let n=c.get(e.id);if(!n)return;a[e.attribute]=l=>n.value(c,l)}for(let e of p||[]){let a=e(c);a&&m.push(a)}y&&!S&&(S=new EventSource("http://localhost:3001/events"),S.onmessage=async e=>{if(e.data==="reload"){let a=await fetch(window.location.href);for(let h of m)h();m=[];let n=b.parseFromString(await a.text(),"text/html");document.body=n.body,document.head.replaceWith(n.head);let l=document.querySelector("[rel=stylesheet]");if(!l)return;let g=l.getAttribute("href");l.setAttribute("href",g.split("?")[0]+"?"+new Date().getTime()),M()}else e.data==="hard-reload"&&window.location.reload()})},"load");globalThis.__ELEGANCE_CLIENT__={navigateLocally:P,fetchPage:E};M();})();
