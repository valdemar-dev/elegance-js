(()=>{var O=Object.defineProperty;var l=(r,a)=>O(r,"name",{value:a,configurable:!0});const P=new DOMParser,j=new XMLSerializer,y=new Map,E=window.location,g=document;let S=[];const d=Array.from,b=l(r=>!r.endsWith("/")||r==="/"?r:r.slice(0,-1),"sanitizePathname");let k=b(E.pathname);const L=l((r=[])=>{const a=new URL(E.href);a.pathname=b(a.pathname);const i=a.pathname;history.replaceState(null,"",a.href);let c=pd[i];if(!c)return;let n=c.stateManager;n||(n={subjects:Object.fromEntries(Object.entries(c.state).map(([e,t])=>[e,{...t,observers:[],pathname:i}])),get:l(e=>Object.values(n.subjects).find(t=>t.id===e),"get"),getKey:l(e=>Object.keys(n.subjects).find(t=>n.subjects[t]===e),"getKey"),signal:l(e=>{const t=e.observers;for(const o of t)o(e.value)},"signal"),observe:l((e,t)=>{e.observers.push(t)},"observe")},c.stateManager=n);for(const e of c.ooa||[]){if(e.key in r)continue;const t=g.querySelector(`[key="${e.key}"]`);let o={};for(const h of e.ids){const s=n.get(h);o[s.id]=s.value;const u=l(p=>{o[h]=p;const v=e.update(...Object.values(o));let w=e.attribute==="class"?"className":e.attribute;t[w]=v},"updateFunction");n.observe(s,u)}const f=e.update(...Object.values(o));let m=e.attribute==="class"?"className":e.attribute;t[m]=f}for(const e of c.soa||[]){if(e.key in r)continue;const t=g.querySelector(`[key="${e.key}"]`),o=n.get(e.id);typeof o.value=="function"?t[e.attribute]=f=>o.value(n,f):t[e.attribute]=o.value}for(const e of c.plh||[]){const t=e(n);t&&S.push(t)}y.set(k,j.serializeToString(g))},"loadPage"),A=l(async r=>{const a=b(r.pathname);if(y.has(a))return P.parseFromString(y.get(a),"text/html");const i=await fetch(r);if(!i.ok)return;const c=P.parseFromString(await i.text(),"text/html"),n=a==="/"?a+"page_data.js":a+"/page_data.js";return pd[a]||await import(n),y.set(a,j.serializeToString(c)),c},"fetchPage"),M=l(async(r,a=!0)=>{const i=new URL(r),c=b(i.pathname);let n=await A(i);if(!n)return;for(const s of S)s();S=[];const e=d(g.querySelectorAll("div[bp]")),t=d(n.querySelectorAll("div[bp]"));let o={currentPage:g.body,newPage:n.body};for(let s=0;s<e.length&&!(s>t.length-1);s++){const u=e[s],p=t[s],v=u.getAttribute("bp"),w=p.getAttribute("bp");if(v!==w)break;o={currentPage:u,newPage:p}}const f=[],m=o.currentPage.getAttribute("key"),h=l(s=>{const u=s.getAttribute("key");if(u&&f.push(u),u!==m)for(const p of d(s.children))h(p)},"getDeprecatedKeysRecursively");h(g.body),o.currentPage.replaceWith(o.newPage),g.head.replaceChildren(...d(n.head.children)),a&&history.pushState(null,"",i.href),k=c,i.hash&&g.getElementById(i.hash.slice(1))?.scrollIntoView(),L(f)},"navigateLocally");window.onpopstate=async r=>{r.preventDefault();const a=r.target;await M(a.location.href,!1),history.replaceState(null,"",a.location.href)};globalThis.__ELEGANCE_CLIENT__={navigateLocally:M,fetchPage:A,currentPage:k,sanitizePathname:b};L();})();
