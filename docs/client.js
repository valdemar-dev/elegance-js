(()=>{var H=Object.defineProperty;var l=(s,o)=>H(s,"name",{value:o,configurable:!0});const M=new DOMParser,$=new XMLSerializer,v=new Map,B=window.location,b=document;let k=[];const L=Array.from,y=l(s=>!s.endsWith("/")||s==="/"?s:s.slice(0,-1),"sanitizePathname");let j=y(B.pathname);const D=l(s=>{const o={subjects:s.map(t=>{const n={...t,observers:new Map};return n.signal=()=>{for(const a of n.observers.values())a(n.value)},n}),get:l((t,n)=>n?pd[n].get(t):o.subjects.find(a=>a.id===t),"get"),getAll:l(t=>t?.map(n=>n.bind?pd[n.bind].get(n.id):o.get(n.id)),"getAll"),observe:l((t,n,a)=>{t.observers.delete(a),t.observers.set(a,n)},"observe")};return o},"createStateManager"),x=l((s=[],o)=>{const t=new URL(B.href);t.pathname=y(t.pathname);const n=t.pathname;history.replaceState(null,"",t.href);let a=pd[n];if(!a)return;for(const[e,i]of Object.entries(a.binds||{})){if(!pd[e]){pd[e]=D(i);continue}const c=pd[e],d=i;for(const h of d)c.get(h.id)||pd[e].subjects.push(h)}let u=a.stateManager;u||(u=D(a.state),a.stateManager=u);for(const e of u.subjects)e.observers=new Map;for(const e of a.ooa||[]){const i=b.querySelector(`[key="${e.key}"]`);let c={};for(const{id:d,bind:h}of e.refs){const f=u.get(d,h);c[f.id]=f.value;const m=l(S=>{c[d]=S;const P=e.update(...Object.values(c));let A=e.attribute==="class"?"className":e.attribute;i[A]=P},"updateFunction");m(f.value),u.observe(f,m,e.key)}}for(const e of a.soa||[]){const i=b.querySelector(`[key="${e.key}"]`),c=u.get(e.id,e.bind);typeof c.value=="function"?i[e.attribute]=d=>c.value(u,d):i[e.attribute]=c.value}const w=a.lh;for(const e of w||[]){const i=e.bind;if(i!==void 0&&o&&!o.includes(`${i}`))continue;const c=e.fn,d=c(u);d&&k.push({cleanupFunction:d,bind:`${i}`})}v.set(j,$.serializeToString(b))},"loadPage"),C=l(async s=>{const o=y(s.pathname);if(v.has(o))return M.parseFromString(v.get(o),"text/html");const t=await fetch(s);if(!t.ok)return;const n=M.parseFromString(await t.text(),"text/html"),a=o==="/"?o+"page_data.js":o+"/page_data.js";return pd[o]||await import(a),v.set(o,$.serializeToString(n)),n},"fetchPage"),E=l(async(s,o=!0)=>{const t=new URL(s),n=y(t.pathname);let a=await C(t);if(!a||n===j)return;const u=L(b.querySelectorAll("div[bp]")),w=u.map(r=>r.getAttribute("bp")),e=L(a.querySelectorAll("div[bp]")),i=e.map(r=>r.getAttribute("bp")),c=l((r,p)=>{let g=0;const F=Math.min(r.length,p.length);for(;g<F&&r[g].getAttribute("bp")===p[g].getAttribute("bp");)g++;return g>0?[r[g-1],p[g-1]]:[document.body,a.body]},"latestMatchingBreakpoints"),[d,h]=c(u,e),f=[],m=d.getAttribute("key"),S=l(r=>{const p=r.getAttribute("key");if(p&&f.push(p),!(p===m||!m))for(const g of L(r.children))S(g)},"getDeprecatedKeysRecursively");S(b.body);const P=w.filter(r=>!i.includes(r)),A=i.filter(r=>!w.includes(r));for(const r of[...k]){const p=r.bind;(p.length<1||P.includes(p))&&(r.cleanupFunction(),k.splice(k.indexOf(r),1))}d.replaceWith(h),b.head.replaceWith(a.head),o&&history.pushState(null,"",t.href),j=n,t.hash&&b.getElementById(t.hash.slice(1))?.scrollIntoView(),x(f,A)},"navigateLocally");window.onpopstate=async s=>{s.preventDefault();const o=s.target;await E(o.location.href,!1),history.replaceState(null,"",o.location.href)};globalThis.client={navigateLocally:E,fetchPage:C,currentPage:j,sanitizePathname:y,getReference:l(s=>document.querySelector(`[ref="${s}"]`),"getReference")};x();})();
