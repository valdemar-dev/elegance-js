(()=>{var j=Object.defineProperty;var i=(n,a)=>j(n,"name",{value:a,configurable:!0});const b=new DOMParser,v=new XMLSerializer,h=new Map;let w=window.location.pathname,g=[];const p=i(n=>!n.endsWith("/")||n==="/"?n:n.slice(0,-1),"sanitizePathname"),O=i((n,a,o)=>{const c=n.ooa;for(const e of c||[]){if(e.key in a)continue;const r=document.querySelector(`[key="${e.key}"]`);let t={};for(const s of e.ids){const l=o.get(s);if(!l)return;t[l.id]=l.value;const y=i(u=>{t[s]=u;const f=e.update(...Object.values(t));let d=e.attribute;switch(d){case"class":d="className";break}r[d]=f},"updateFunction");o.observe(l,y)}}},"loadObserverObjectAttributes"),L=i((n,a,o)=>{const c=n.soa;for(const e of c||[]){if(e.key in a)continue;const r=document.querySelector(`[key="${e.key}"]`);if(!r)return;const t=o.get(e.id);if(!t)return;typeof t.value=="function"?r[e.attribute]=s=>t.value(o,s):r[e.attribute]=t.value}},"loadStateObjectAttributes"),m=i((n=[])=>{let a=p(window.location.pathname),o=pd[a];if(!o)return;const c=o.state,e=o.plh,r={subjects:{},get:i(t=>Object.values(r.subjects).find(s=>s.id===t),"get"),set:i((t,s)=>{t.value=s,r.subjects[Object.keys(t)[0]]=t},"set"),signal:i(t=>{const s=t.observers;for(const l of s)l(t.value)},"signal"),observe:i((t,s)=>{t.observers.push(s)},"observe")};for(const[t,s]of Object.entries(c)){const l=s;r.subjects[t]={id:l.id,value:l.value,observers:[],pathname:a}}O(o,n,r),L(o,n,r);for(const t of e||[]){const s=t(r);s&&g.push(s)}},"loadPage"),S=i(async n=>{const a=p(n.pathname);if(h.has(a)||n.hostname!==window.location.hostname)return;const o=await fetch(n),c=await o.text();if(!o.ok&&o.status>=500)return;const e=b.parseFromString(c,"text/html"),r=a==="/"?a+"page_data.js":a+"/page_data.js";return pd[a]||await import(r),h.set(a,v.serializeToString(e)),e},"fetchPage"),E=i(({breakpointKey:n,document:a})=>{const o=[],c=i(e=>{const r=e.getAttribute("key");if(r&&o.push(r),e.children){if(r===n)return;for(const t of Array.from(e.children))c(t)}},"getRecursively");return c(a.body),o},"getDeprecatedKeys"),k=i(async(n,a=!0)=>{for(const u of g)u();g=[],h.set(w,v.serializeToString(document));const o=new URL(n),c=p(o.pathname);let e=h.get(c)??await S(o);if(!e)return;typeof e=="string"&&(e=b.parseFromString(e,"text/html"));const r=Array.from(document.querySelectorAll("div[bp]")),t=Array.from(e.querySelectorAll("div[bp]"));let s={currentPage:document.body,newPage:e.body};for(let u=0;u<r.length&&!(u>t.length-1);u++){const f=r[u],d=t[u],A=f.getAttribute("bp"),P=d.getAttribute("bp");if(A!==P)break;s={currentPage:f,newPage:d}}const l=E({breakpointKey:s.currentPage.getAttribute("key"),document:e});s.currentPage.parentElement?.replaceChild(s.newPage,s.currentPage),document.head.replaceChildren(...Array.from(e.head.children)),a&&history.pushState(null,"",n),m(l),w=c},"navigateLocally");window.onpopstate=async n=>{n.preventDefault();const a=n.target;await k(a.location.href,!1),history.replaceState(null,"",p(a.location.pathname))};globalThis.__ELEGANCE_CLIENT__={navigateLocally:k,fetchPage:S};m();if(Object.values(pd)[0]?.w){const n=new EventSource("http://localhost:3001/events");n.onmessage=async a=>{if(a.data==="reload"){const o=await fetch(window.location.href);for(const t of g)t();g=[];const c=b.parseFromString(await o.text(),"text/html");document.body=c.body,document.head.replaceWith(c.head);const e=document.querySelector("[rel=stylesheet]");if(!e)return;const r=e.getAttribute("href");e.setAttribute("href",r.split("?")[0]+"?"+new Date().getTime()),m()}else a.data==="hard-reload"&&window.location.reload()}}})();
