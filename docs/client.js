(()=>{var O=Object.defineProperty;var l=(o,t)=>O(o,"name",{value:t,configurable:!0});const S=new DOMParser,E=new XMLSerializer,m=new Map,L=window.location,g=document;let k=[];const b=Array.from,p=l(o=>!o.endsWith("/")||o==="/"?o:o.slice(0,-1),"sanitizePathname");let P=p(L.pathname);const j=l((o=[])=>{const t=new URL(L.href);t.pathname=p(t.pathname);const i=t.pathname;history.replaceState(null,"",t.href);let r=pd[i];if(!r)return;let a=r.stateManager;a||(a={subjects:Object.fromEntries(Object.entries(r.state).map(([e,n])=>[e,{...n,observers:[],pathname:i}])),get:l(e=>Object.values(a.subjects).find(n=>n.id===e),"get"),getKey:l(e=>Object.keys(a.subjects).find(n=>a.subjects[n]===e),"getKey"),signal:l(e=>{const n=e.observers;for(const s of n)s(e.value)},"signal"),observe:l((e,n)=>{e.observers.push(n)},"observe")},r.stateManager=a);for(const e of r.ooa||[]){if(e.key in o)continue;const n=g.querySelector(`[key="${e.key}"]`);let s={};for(const f of e.ids){const c=a.get(f);s[c.id]=c.value;const u=l(h=>{s[f]=h;const w=e.update(...Object.values(s));let v=e.attribute==="class"?"className":e.attribute;n[v]=w},"updateFunction");a.observe(c,u)}const d=e.update(...Object.values(s));let y=e.attribute==="class"?"className":e.attribute;n[y]=d}for(const e of r.soa||[]){if(e.key in o)continue;const n=g.querySelector(`[key="${e.key}"]`),s=a.get(e.id);typeof s.value=="function"?n[e.attribute]=d=>s.value(a,d):n[e.attribute]=s.value}for(const e of r.plh||[]){const n=e(a);n&&k.push(n)}m.set(P,E.serializeToString(g))},"loadPage"),M=l(async o=>{const t=p(o.pathname);if(m.has(t))return S.parseFromString(m.get(t),"text/html");const i=await fetch(o);if(!i.ok)return;const r=S.parseFromString(await i.text(),"text/html"),a=t==="/"?t+"page_data.js":t+"/page_data.js";return pd[t]||await import(a),m.set(t,E.serializeToString(r)),r},"fetchPage"),A=l(async(o,t=!0)=>{const i=new URL(o),r=p(i.pathname);let a=await M(i);if(!a)return;for(const c of k)c();k=[];const e=b(g.querySelectorAll("div[bp]")),n=b(a.querySelectorAll("div[bp]"));let s={currentPage:g.body,newPage:a.body};for(let c=0;c<e.length&&!(c>n.length-1);c++){const u=e[c],h=n[c],w=u.getAttribute("bp"),v=h.getAttribute("bp");if(w!==v)break;s={currentPage:u,newPage:h}}const d=[],y=s.currentPage.getAttribute("key"),f=l(c=>{const u=c.getAttribute("key");if(u&&d.push(u),u!==y)for(const h of b(c.children))f(h)},"getDeprecatedKeysRecursively");f(g.body),s.currentPage.replaceWith(s.newPage),g.head.replaceChildren(...b(a.head.children)),t&&history.pushState(null,"",i.href),P=r,i.hash&&g.getElementById(i.hash.slice(1))?.scrollIntoView(),j(d)},"navigateLocally");window.onpopstate=async o=>{o.preventDefault();const t=o.target;await A(t.location.href,!1),history.replaceState(null,"",t.location.href)};globalThis.__ELEGANCE_CLIENT__={navigateLocally:A,fetchPage:M,currentPage:P,sanitizePathname:p};j();if(Object.values(pd)[0]?.w){const o=new EventSource("http://localhost:3001/events");o.onmessage=async t=>{if(t.data==="reload"){const i=await fetch(window.location.href),r=S.parseFromString(await i.text(),"text/html");document.body=r.body,document.head.replaceWith(r.head);const a=document.querySelector("[rel=stylesheet]");if(!a)return;const e=a.getAttribute("href");a.setAttribute("href",e.split("?")[0]+"?"+new Date().getTime()),j()}else t.data==="hard-reload"&&window.location.reload()}}})();
