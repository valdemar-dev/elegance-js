"use strict";(()=>{var D=Object.defineProperty;var i=(t,o)=>D(t,"name",{value:o,configurable:!0});var b=new DOMParser,f=new XMLSerializer,w=new Map,p=null,M=i(async t=>{if(t.hostname!==window.location.hostname)throw"Client-side navigation may only occur on local URL's";let o=await fetch(t),l=await o.text();if(!o.ok)throw l;let r=b.parseFromString(l,"text/html"),d=`${t.pathname}/page_data.js`;return pd[t.pathname]||await import(d),w.set(t.pathname,f.serializeToString(r)),r},"fetchLocalPage"),m=window.location.pathname;globalThis.navigateLocally=async(t,o=!0)=>{w.set(m,f.serializeToString(document));let l=new URL(t),r=w.get(l.pathname)??await M(l);o&&history.pushState(null,"",t),r instanceof Document?document.body=r.body:document.body=b.parseFromString(r,"text/html").body,g(),m=window.location.pathname};window.onpopstate=async t=>{t.preventDefault();let o=t.target;await navigateLocally(o.location.href,!1),history.replaceState(null,"",o.location.pathname)};var g=i(()=>{let t=window.location.pathname;t.endsWith("/")&&t!=="/"&&(t=t.slice(0,-1));let o=pd[t];if(!o)throw`Invalid Elegance Configuration. Page.JS is not properly sent to the Client. Pathname: ${window.location.pathname}`;let l=o.state,r=o.ooa,d=o.soa,y=o.w,v=o.plh,s={subjects:{},populate:i(e=>{for(let[a,n]of Object.entries(e)){let c=n;s.subjects[a]={id:c.id,value:c.value,observers:[]}}},"populate"),get:i(e=>Object.values(s.subjects).find(a=>a.id===e),"get"),set:i((e,a)=>{e.value=a,s.subjects[Object.keys(e)[0]]=e},"set"),signal:i(e=>{let a=e.observers;for(let n of a)n(e.value)},"signal"),observe:i((e,a)=>{e.observers.push(a)},"observe")};s.populate(l),o.sm=s;for(let e of r||[]){let a=document.querySelector(`[key="${e.key}"]`),n={};for(let c of e.ids){let u=s.get(c);if(!u)throw`No subject with id ${c}`;n[u.id]=u.value;let S=i(j=>{n[c]=j;let k=e.update(...Object.values(n)),h=e.attribute;switch(h){case"class":h="className";break}a[h]=k},"updateFunction");s.observe(u,S)}}for(let e of d||[]){let a=document.querySelector(`[key="${e.key}"]`),n=s.get(e.id);if(!n)throw`SOA, no subject with ID: ${e.id}`;a[e.attribute]=c=>n.value(s,c)}for(let e of v||[])e(s);y&&!p&&(p=new EventSource("http://localhost:3001/events"),p.onmessage=async e=>{if(e.data==="reload"){let a=await fetch(window.location.href);document.body=new DOMParser().parseFromString(await a.text(),"text/html").body;let n=document.querySelector("[rel=stylesheet]");if(!n)return;let c=n.getAttribute("href");n.setAttribute("href",c.split("?")[0]+"?"+new Date().getTime()),g()}else e.data==="hard-reload"&&window.location.reload()})},"load");g();})();
