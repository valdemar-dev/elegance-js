var b=u=>{let e;return t=>{clearTimeout(e),e=setTimeout(()=>{t()},u)}};var c=class{constructor(e,t,s=!1,o=null,i="",r=1,n=!1){this.observers=[];this.enforceRuntimeTypes=s,this.value=e,this.id=t,this.pathname=i,this.scope=r,this.resetOnPageLeave=n,o&&(this.debounce=b(o))}observe(e){this.observers.push({callback:e})}signal(){let e=async()=>{let t=this.get();for(let s of this.observers)s.callback(t)};this.debounce?this.debounce(e):e()}set(e){if(this.enforceRuntimeTypes&&typeof e!=typeof this.value){console.error(`Type of new value: ${e} (${typeof e}) does not match the type of this subject's value ${this.value} (${typeof this.value}).`);return}this.value=e}add(e){if(!Array.isArray(this.value)){console.error("The add method of a subject may only be used if the subject's value is an Array.");return}this.value.push(e)}remove(e){if(!Array.isArray(this.value)){console.error("The remove method of a subject may only be used if the subject's value is an Array.");return}let t=this.value.indexOf(e);t||console.error(`Element ${e} does not exist in this subject, therefore it cannot be removed.`),this.value.splice(t,1)}get(){return this.value}},l=class{constructor(){this.subjectStore=[]}create(e,{id:t,enforceRuntimeTypes:s=!0,debounceUpdateMs:o,resetOnPageLeave:i=!1}){let r=this.subjectStore.find(a=>a.pathname===window.location.pathname&&a.id===t);if(r)return console.info(`%cSubject with ID ${t} already exists, therefore it will not be re-created.`,"font-size: 12px; color: #aaaaff"),r;let n=new c(e,t,s,o,window.location.pathname,1,i);return this.subjectStore.push(n),n}createGlobal(e,{id:t,enforceRuntimeTypes:s=!0,debounceUpdateMs:o,resetOnPageLeave:i=!1}){let r=this.subjectStore.find(a=>a.scope===2&&a.id===t);if(r)return console.info(`%cGlobal Subject with ID ${t} already exists, therefore it will not be re-created.`,"font-size: 12px; color: #aaaaff"),r;let n=new c(e,t,s,o,"",2,i);return this.subjectStore.push(n),n}getGlobal(e){let t=this.subjectStore.find(s=>s.scope===2&&s.id===e);if(!t)throw new Error(`Could not find a global subject with the ID of ${e}.`);return t}get(e){let t=this.subjectStore.find(s=>s.pathname===window.location.pathname&&s.id===e);if(!t){console.error(`Could not find a subject with the ID of ${e} in the page ${window.location.pathname}`);return}return t}observe(e,t,s=1){if(s===1){let o=this.get(e);if(!o)return;o.observe(t)}else this.getGlobal(e).observe(t)}resetEphemeralSubjects(){this.subjectStore=this.subjectStore.filter(e=>e.resetOnPageLeave===!1)}cleanSubjectObservers(){for(let e of this.subjectStore)e.observers=[]}};export{l as StateController};
